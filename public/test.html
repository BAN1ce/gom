<!doctype html>
<html>
<head>
  <title></title>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/flat-ui/2.0/css/flat-ui.css">
  <style>
    @import ur(//cdn.jsdelivr.net/flat-ui/2.0/fonts/Flat-UI-Icons.dev.svg);
    .right{float:right}
    .filter{width:100%}
    .container{ width: 800px; margin: 50px auto;}
  </style>
</head>
<body>
  <div class="container">
    <div class="row">
    </div>
    <div class="row">
        <h3>Profiles</h3>
        <span class="fui-alert-circle"></span>
        <p>
        <span class="fui-repeat"></span>
          <button type="button" class="cpu btn btn-primary">CPU</button>
          <button type="button" class="heap btn btn-primary">Heap</button>
          <button type="button" class="refresh btn right">Refresh</button>
        </p>
        <input type="text" class="filter" placeholder="Focus by keyword...">
        <div class="row"><pre class="results"></pre></div>
      </div>
  </div>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script type="text/javascript">
    var profile = "heap";
    refresh();
    $(".cpu").on("click", function() {
      profile = "profile";
      refresh();
    });
    $(".heap").on("click", function() {
      profile = "heap";
      refresh();
    });
    $(".refresh").on("click", function() {
      refresh(true);
    });
    $(".filter").on("keyup", function() {
      refresh();
    });
    function refresh(force) {
      // TODO: cancel the existing request if it's not ciompleted.
      $('.results').html('Loading, be patient... CPU profile takes 30 seconds.');
      var f = $('.filter').val();
      $.get('/p', {
        profile: profile,
        filter: f,
        force: !!force
      }).done(function(data) {
        $('.results').html(data);
      }).fail(function(data) {
        $('.results').html(data);
      });
    };
  </script>
</body>
</html>
